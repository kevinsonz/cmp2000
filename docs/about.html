<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMP2000 Official Portal</title>
    
    <!-- ファビコン -->
    <link rel="icon" type="image/png" href="./images/cmp2000-favicon.png">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    
    <!-- Bootstrap JavaScript Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

    <!-- カスタムスタイルシート -->
    <link rel="stylesheet" href="./style.css">

    <!-- ローカル開発用データ（GitHub Pagesでは404になるが問題なし） -->
    <script src="./basic-info.js" onerror="console.log('ローカルデータなし: オンラインモードで動作します')"></script>
    <script src="./about-data.js" onerror="console.log('アバウトデータなし: オンラインモードで動作します')"></script>
    
    <!-- about専用スクリプト（defer属性でHTML解析後に実行） -->
    <script src="./about-script.js" defer></script>
</head>

<body class="bg-light">
    <!-- ページヘッダー -->
    <header id="main-header" class="sticky-top bg-light border-bottom">
        <h1 class="text-center py-3 mb-0">CMP2000 Official Portal</h1>
    </header>

    <!-- ページメニュー -->
    <div class="page-menu-wrapper">
        <div class="page-menu">
            <a href="index.html" class="page-menu-item">Home</a>
            <span class="page-menu-separator">|</span>
            <a href="about.html" class="page-menu-item active">About</a>
            <span class="page-menu-separator">|</span>
            <a href="history.html" class="page-menu-item">History</a>
        </div>
    </div>

    <!-- メインコンテンツ -->
    <div class="page-container">
        <div class="mb-3 text-center">
            <a href="index.html" class="btn btn-outline-primary">← ポータルページへ戻る</a>
        </div>
        
        <h2 class="text-center mb-3">About</h2>
        
        <!-- 理念セクション -->
        <div class="philosophy-section mb-4">
            <div class="card">
                <div class="card-header bg-white d-flex justify-content-center align-items-center">
                    <strong>CMP2000とは</strong>
                </div>
                <div class="card-body p-3">
                    <p class="mb-3" style="line-height: 1.4;">
                        <strong>Creation Meets Peace</strong>＝『創造』と『平和』の出会い。<br>
                        争いの絶えない世の中において、平和は自然に生まれるモノではなく、ヒトの創造によって実現されるモノである、という理念。
                    </p>
                    
                    <hr class="my-3">
                    
                    <div class="mb-3">
                        <h6 class="mb-1 fw-bold">けびんケビンソン</h6>
                        <p class="mb-0 small text-muted" style="line-height: 1.5;">
                            2019年（コロナ禍）頃からの参画で、現在はCMP2000管理人の役割を担っている。「何か」をしたくて活動しており、現在も模索中。
                        </p>
                    </div>
                    
                    <div class="mb-0">
                        <h6 class="mb-1 fw-bold">イイダリョウ</h6>
                        <p class="mb-0 small text-muted" style="line-height: 1.5;">
                            2014年頃から参画しているCMP2000主要メンバー。多岐に渡るキャリアを経ており、現在はフロントエンドを中心としたエンジニア。
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- フィルターUI表示エリア -->
        <div id="filter-ui-container" style="display: none; margin-bottom: 1rem;"></div>
        
        <div id="about-content" class="bg-white p-4 rounded shadow-sm">
            <!-- JavaScriptで自動生成 -->
        </div>
    </div>

    <!-- ジャンプメニュー（Bootstrap dropdown使用） -->
    <div class="dropup position-fixed bottom-0 end-0 m-3" style="z-index: 1000;">
        <button class="btn btn-primary rounded-circle shadow" type="button" id="jumpMenuButton" data-bs-toggle="dropdown" aria-expanded="false" style="width: 60px; height: 60px;">
            ☰
        </button>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="jumpMenuButton">
            <li><a class="dropdown-item" href="#" onclick="window.scrollTo(0,0); return false;">ヘッダー</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#common">共通コンテンツ</a></li>
            <li><a class="dropdown-item" href="#kevin">けびんケビンソン</a></li>
            <li><a class="dropdown-item" href="#ryo">イイダリョウ</a></li>
            <li><a class="dropdown-item" href="#staff">スタッフ</a></li>
            <li><a class="dropdown-item" href="#family">ファミリー</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#footer">フッター</a></li>
        </ul>
    </div>

    <!-- ハッシュタグ一覧セクション -->
    <div id="hashtag-list-section" class="hashtag-list-section">
        <div class="container text-center">
            <h4 class="mb-3">ハッシュタグ一覧</h4>
            <div id="hashtag-list" class="hashtag-list"></div>
        </div>
    </div>

    <!-- フッター -->
    <footer id="footer" class="text-center py-4 mt-5 border-top bg-light">
        <p class="mb-0 text-muted">
            <small>&copy; 2000-<span id="current-year"></span> CMP2000</small>
        </p>
    </footer>

    <script>
        // 基本情報CSVの解析
        function parseBasicInfoCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const items = [];
            
            const keyIndex = headers.indexOf('key');
            const categoryIndex = headers.indexOf('category');
            const siteTitleIndex = headers.indexOf('siteTitle');
            const hashTagIndex = headers.indexOf('hashTag');
            const siteUrlIndex = headers.indexOf('siteUrl');
            const logoIndex = headers.indexOf('logo');
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                
                // cmp2000は除外
                if (values[keyIndex] === 'cmp2000') continue;
                
                if (values[keyIndex] && values[categoryIndex] && values[siteTitleIndex]) {
                    items.push({
                        key: values[keyIndex],
                        category: values[categoryIndex],
                        siteTitle: values[siteTitleIndex],
                        hashTag: values[hashTagIndex] || '',
                        siteUrl: values[siteUrlIndex] || '#',
                        logo: values[logoIndex] || ''
                    });
                }
            }
            
            return items;
        }

        // アーカイブCSVの解析
        function parseArchiveCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const items = [];
            
            const categoryIndex = headers.indexOf('category');
            const siteTitleIndex = headers.indexOf('siteTitle');
            const hashTagIndex = headers.indexOf('hashTag');
            const siteUrlIndex = headers.indexOf('siteUrl');
            const logoIndex = headers.indexOf('logo');
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                
                if (values[categoryIndex] && values[siteTitleIndex]) {
                    items.push({
                        category: values[categoryIndex],
                        siteTitle: values[siteTitleIndex],
                        hashTag: values[hashTagIndex] || '',
                        siteUrl: values[siteUrlIndex] || '#',
                        logo: values[logoIndex] || ''
                    });
                }
            }
            
            return items;
        }

        // ファミリーCSVの解析
        function parseFamilyCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const items = [];
            
            const categoryIndex = headers.indexOf('category');
            const nameIndex = headers.indexOf('name');
            const commentIndex = headers.indexOf('comment');
            const hashTagIndex = headers.indexOf('hashTag');
            
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i];
                const values = [];
                let currentValue = '';
                let insideQuotes = false;
                
                // カンマ区切りの解析（コメント内のカンマを考慮）
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '"') {
                        insideQuotes = !insideQuotes;
                    } else if (char === ',' && !insideQuotes) {
                        values.push(currentValue.trim());
                        currentValue = '';
                    } else {
                        currentValue += char;
                    }
                }
                values.push(currentValue.trim());
                
                if (values[categoryIndex] && values[nameIndex]) {
                    items.push({
                        category: values[categoryIndex],
                        name: values[nameIndex],
                        comment: values[commentIndex] || '',
                        hashTag: values[hashTagIndex] || ''
                    });
                }
            }
            
            return items;
        }

        // ハッシュタグフィルタリング用のグローバル変数
        let currentFilterTag = null;
        let allBasicInfo = [];
        let allArchiveInfo = [];
        let allFamilyInfo = [];

        // ハッシュタグをパースする関数（半角・全角スペース対応）
        function parseHashTags(hashTagString) {
            if (!hashTagString) return [];
            // 半角スペースと全角スペースの両方で分割
            return hashTagString.split(/[\s\u3000]+/).filter(tag => tag.startsWith('#')).map(tag => tag.trim());
        }

        // すべてのハッシュタグを収集する関数（サイト、アーカイブ、ファミリーすべてから）
        function collectAllHashTags(basicInfo, archiveInfo, familyInfo) {
            const hashTagSet = new Set();
            basicInfo.forEach(item => {
                const tags = parseHashTags(item.hashTag);
                tags.forEach(tag => hashTagSet.add(tag));
            });
            archiveInfo.forEach(item => {
                const tags = parseHashTags(item.hashTag);
                tags.forEach(tag => hashTagSet.add(tag));
            });
            familyInfo.forEach(item => {
                const tags = parseHashTags(item.hashTag);
                tags.forEach(tag => hashTagSet.add(tag));
            });
            return Array.from(hashTagSet).sort();
        }

        // ハッシュタグ一覧を生成する関数（ボタンスタイル）
        function generateHashTagList(allTags, filterTag = null) {
            const container = document.getElementById('hashtag-list');
            if (!container) return;
            
            container.innerHTML = '';
            
            allTags.forEach(tag => {
                const tagButton = document.createElement('button');
                tagButton.className = 'hashtag-button';
                tagButton.textContent = tag;
                
                if (filterTag && tag === filterTag) {
                    tagButton.classList.add('active');
                }
                
                tagButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (currentFilterTag === tag) {
                        clearHashTagFilter();
                    } else {
                        applyHashTagFilter(tag);
                    }
                });
                
                container.appendChild(tagButton);
            });
        }

        // フィルターUIを表示
        function showFilterUI(tag) {
            const container = document.getElementById('filter-ui-container');
            if (!container) return;
            
            container.style.display = 'block';
            container.innerHTML = `
                <div class="alert alert-info d-flex justify-content-between align-items-center">
                    <span>表示中: <strong>${tag}</strong></span>
                    <button class="btn btn-sm btn-secondary" onclick="clearHashTagFilter()">フィルター解除</button>
                </div>
            `;
        }

        // フィルターUIを非表示
        function hideFilterUI() {
            const container = document.getElementById('filter-ui-container');
</body>
</html>